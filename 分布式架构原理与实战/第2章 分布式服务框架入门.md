# 第2章 分布式服务框架入门
### 2.1 分布式框架诞生的背景
- 应用从集中式走向分布式
- 需要服务治理框架，随着服务数的增加，需要一个服务治理框架，有效管控服务，提升服务运行期质量

    ##### 服务治理诉求
    - 生命期管理，服务上线前审批流程，测试发布流程和服务下线通知机制需要规范化
    - 服务容量规划，服务调用量变大，服务容量问题逐渐暴漏出来，某个服务需要多少机器支撑，什么时候该添加机器，需要什么样的配置。
    - 运行期治理，大促期间流量暴增，系统资源成为瓶颈，对核心服务采取降级、限流的措施，保证核心业务运行，缓存击穿导致系统压力转移至数据库，服务调用时延增大，业务失败率变高，为了提供成功率，需要降级等策略。
    - 服务安全，敏感数据服务化后，需要对消费者鉴权，防止非法访问。服务安全是服务治理的核心功能之一。
### 2.2 业界分布式框架介绍

- 阿里dubbo
- 淘宝HSF
- 亚马逊 Coral Service

### 2.3 分布式框架设计
- 架构原理
    
    通常，分布式框架的架构可以抽象为3层。
    1. RPC层，包括底层通信框架（如：NIO框架的封装，公有协议的封装等）、序列化和反序列化框架、用于屏蔽底层通信协议的细节和序列化方式差异的Remoting框架
    2. filter chain层，服务职责链，如：负载均衡、服务调用性能统计、服务完成通知机制、失败重连等。
    3. Service层，具体的业务api接口
    
- 功能特性

特性名 | 功能名 | 说明
---|---|---
服务路由 | 默认提供随机路由、轮询、基于权重的路由策略 | 避免重复开发
集群容错 | failover，failback，failfast |失败自动切换，失败自动恢复，快速失败
服务调用|异步调用、同步调用、并发调用 |消费者发起服务调用后，不阻塞立即响应，阻塞等待响应，多个消费者同时发起服务调用，集中响应
多协议 |私有协议，公有协议 |
序列化方式 |二进制类序列化，文本类序列化|
统一配置 |本地静态配置，基于配置中心的动态配置 |

- 性能特性

 线性特性 | 说明
---|---
高性能| 同等资源下，单服务tps要高
低延时| 调用延时要尽量低
性能线性增长| 扩展服务提供者，性能要能线性增长

- 可靠性

- 服务治理
    
    - [x]     服务运行态管理，服务路由、服务限流、服务迁入迁出、服务降级、服务超时控制
    - [x]     服务监控，性能统计、统计报表、告警
    - [x]     服务生命周期管理，上线审批，下线通知、服务灰度发布
    - [x]     故障快速定界定为，分布式日志采集、海量日志在线检索、调用连可视化展示、运行日志故障定位
    - [x]     服务安全，敏感服务的授权策略、链路的安全防护